--[[ 
    üõ°Ô∏è SMVLLHUB INSTANT STEAL - FIXED & MOBILE OPTIMIZED
    - UI: Green & Black (SMVLL Style)
    - Logic 1: TON DESYNC (FFlags + NoAnim + Reset CFrame)
    - Logic 2: TON SET POS & TP STEAL (Beams + Respawn Logic)
    - UI FIX: R√©tractation fluide via Tween + Mobile Scaling
]]

--// SMVLLHUB WHITELIST (USERNAME BASED)

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Whitelist = {
    ["dodo1424x"] = true,
    ["Dzmahrezdz"] = true,
    ["Nat0000000000000000"] = true,
    ["hatchingplayz"] = true,
    ["Road2nemesis_nop2w"] = true,
    ["le_dz93100"] = true,
}

if not Whitelist[LocalPlayer.Name] then
    LocalPlayer:Kick([[u are not whitelisted go buy the access in https://discord.gg/sFmfhdt3V2

SMVLLHUB OT]])
    task.wait(9e9)
end

-- ‚Üì‚Üì‚Üì LE RESTE DE TON SCRIPT
local Players = game:GetService("Players")
local ProximityPromptService = game:GetService("ProximityPromptService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- --- CONFIGURATION VISUELLE ---
local SMVLL_GREEN = Color3.fromRGB(0, 255, 100)
local SMVLL_BG = Color3.fromRGB(0, 0, 0)
local SMVLL_TEXT = Color3.fromRGB(255, 255, 255)
local SNOW_WHITE = Color3.fromRGB(255, 255, 255)

-- D√©tection Mobile pour taille UI
local isMobile = UserInputService.TouchEnabled
local UI_WIDTH = isMobile and 200 or 260
local UI_HEIGHT = isMobile and 180 or 230

local function rnd() return HttpService:GenerateGUID(false):gsub("-", ""):sub(1, 12) end

-- --- LOGIQUE DESYNC ---
local desyncActive = false
local firstActivation = true

local FFlags = { GameNetPVHeaderRotationalVelocityZeroCutoffExponent = -5000, LargeReplicatorWrite5 = true, LargeReplicatorEnabled9 = true, AngularVelociryLimit = 360, TimestepArbiterVelocityCriteriaThresholdTwoDt = 2147483646, S2PhysicsSenderRate = 15000, DisableDPIScale = true, MaxDataPacketPerSend = 2147483647, PhysicsSenderMaxBandwidthBps = 20000, TimestepArbiterHumanoidLinearVelThreshold = 21, MaxMissedWorldStepsRemembered = -2147483648, PlayerHumanoidPropertyUpdateRestrict = true, SimDefaultHumanoidTimestepMultiplier = 0, StreamJobNOUVolumeLengthCap = 2147483647, DebugSendDistInSteps = -2147483648, GameNetDontSendRedundantNumTimes = 1, CheckPVLinearVelocityIntegrateVsDeltaPositionThresholdPercent = 1, CheckPVDifferencesForInterpolationMinVelThresholdStudsPerSecHundredth = 1, LargeReplicatorSerializeRead3 = true, ReplicationFocusNouExtentsSizeCutoffForPauseStuds = 2147483647, CheckPVCachedVelThresholdPercent = 10, CheckPVDifferencesForInterpolationMinRotVelThresholdRadsPerSecHundredth = 1, GameNetDontSendRedundantDeltaPositionMillionth = 1, InterpolationFrameVelocityThresholdMillionth = 5, StreamJobNOUVolumeCap = 2147483647, InterpolationFrameRotVelocityThresholdMillionth = 5, CheckPVCachedRotVelThresholdPercent = 10, WorldStepMax = 30, InterpolationFramePositionThresholdMillionth = 5, TimestepArbiterHumanoidTurningVelThreshold = 1, SimOwnedNOUCountThresholdMillionth = 2147483647, GameNetPVHeaderLinearVelocityZeroCutoffExponent = -5000, NextGenReplicatorEnabledWrite4 = true, TimestepArbiterOmegaThou = 1073741823, MaxAcceptableUpdateDelay = 1, LargeReplicatorSerializeWrite4 = true }
local defaultFFlags = { GameNetPVHeaderRotationalVelocityZeroCutoffExponent = 8, LargeReplicatorWrite5 = false, LargeReplicatorEnabled9 = false, AngularVelociryLimit = 180, TimestepArbiterVelocityCriteriaThresholdTwoDt = 100, S2PhysicsSenderRate = 60, DisableDPIScale = false, MaxDataPacketPerSend = 1024, PhysicsSenderMaxBandwidthBps = 10000, TimestepArbiterHumanoidLinearVelThreshold = 10, MaxMissedWorldStepsRemembered = 10, PlayerHumanoidPropertyUpdateRestrict = false, SimDefaultHumanoidTimestepMultiplier = 1, StreamJobNOUVolumeLengthCap = 1000, DebugSendDistInSteps = 10, GameNetDontSendRedundantNumTimes = 10, CheckPVLinearVelocityIntegrateVsDeltaPositionThresholdPercent = 50, CheckPVDifferencesForInterpolationMinVelThresholdStudsPerSecHundredth = 100, LargeReplicatorSerializeRead3 = false, ReplicationFocusNouExtentsSizeCutoffForPauseStuds = 100, CheckPVCachedVelThresholdPercent = 50, CheckPVDifferencesForInterpolationMinRotVelThresholdRadsPerSecHundredth = 100, GameNetDontSendRedundantDeltaPositionMillionth = 100, InterpolationFrameVelocityThresholdMillionth = 100, StreamJobNOUVolumeCap = 1000, InterpolationFrameRotVelocityThresholdMillionth = 100, CheckPVCachedRotVelThresholdPercent = 50, WorldStepMax = 60, InterpolationFramePositionThresholdMillionth = 100, TimestepArbiterHumanoidTurningVelThreshold = 10, SimOwnedNOUCountThresholdMillionth = 1000, GameNetPVHeaderLinearVelocityZeroCutoffExponent = 8, NextGenReplicatorEnabledWrite4 = false, TimestepArbiterOmegaThou = 1000, MaxAcceptableUpdateDelay = 10, LargeReplicatorSerializeWrite4 = false }

local function applyFFlags(flags)
    for name, value in pairs(flags) do
        pcall(function() setfflag(tostring(name), tostring(value)) end)
    end
end

RunService.PreRender:Connect(function()
    if desyncActive and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            for _, track in pairs(hum:GetPlayingAnimationTracks()) do
                if track.Name:lower():find("walk") or track.Name:lower():find("run") then track:AdjustSpeed(0) end
            end
        end
    end
end)

-- --- LOGIQUE SET POS & TP ---
local targetPositions = { Vector3.new(-481.88, -3.79, 138.02), Vector3.new(-481.75, -3.79, 89.18), Vector3.new(-481.82, -3.79, 30.95), Vector3.new(-481.75, -3.79, -17.79), Vector3.new(-481.80, -3.79, -76.06), Vector3.new(-481.72, -3.79, -124.70), Vector3.new(-337.45, -3.85, -124.72), Vector3.new(-337.37, -3.85, -76.07), Vector3.new(-337.46, -3.79, -17.72), Vector3.new(-337.41, -3.79, 30.92), Vector3.new(-337.32, -3.79, 89.02), Vector3.new(-337.27, -3.79, 137.90), Vector3.new(-337.45, -3.79, 196.29), Vector3.new(-337.37, -3.79, 244.91), Vector3.new(-481.72, -3.79, 196.21), Vector3.new(-481.76, -3.79, 244.92) }
local pos1, pos2
local beam1, beam2, part1, part2

local function createBeam(position, index)
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local part = Instance.new("Part", Workspace)
    part.Anchored = true; part.CanCollide = false; part.Transparency = 1; part.CFrame = CFrame.new(position)
    local a0 = Instance.new("Attachment", part); local a1 = Instance.new("Attachment", char.HumanoidRootPart)
    local beam = Instance.new("Beam", Workspace)
    beam.Attachment0 = a0; beam.Attachment1 = a1; beam.Width0 = 0.5; beam.Width1 = 0.5; beam.FaceCamera = true
    beam.Color = ColorSequence.new(SMVLL_GREEN); beam.LightEmission = 1
    if index == 1 then
        if beam1 then beam1:Destroy() end; if part1 then part1:Destroy() end
        beam1, part1 = beam, part
    else
        if beam2 then beam2:Destroy() end; if part2 then part2:Destroy() end
        beam2, part2 = beam, part
    end
end

local function RespawnPlayer()
    local char = LocalPlayer.Character
    if not char then return end
    local hum = char:FindFirstChildWhichIsA("Humanoid")
    if hum then hum:ChangeState(Enum.HumanoidStateType.Dead) end
    char:ClearAllChildren()
    local temp = Instance.new("Model", Workspace)
    LocalPlayer.Character = temp
    task.wait()
    LocalPlayer.Character = char
    temp:Destroy()
end

-- --- INTERFACE SMVLLHUB ---
local gui = Instance.new("ScreenGui", (gethui and gethui()) or CoreGui)
gui.Name = rnd(); gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromOffset(UI_WIDTH, UI_HEIGHT); frame.Position = UDim2.fromScale(0.5, 0.5); frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.BackgroundColor3 = SMVLL_BG; frame.BackgroundTransparency = 0.2; frame.Active = true; frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)
local stroke = Instance.new("UIStroke", frame); stroke.Color = SMVLL_GREEN; stroke.Thickness = 2

local function createSnow(p)
    task.spawn(function()
        while task.wait(0.3) do
            if not p or not p.Parent then break end
            local flake = Instance.new("TextLabel", p)
            flake.Size = UDim2.new(0, 4, 0, 4); flake.Position = UDim2.new(math.random(), 0, -0.1, 0)
            flake.Text = "‚Ä¢"; flake.TextColor3 = SNOW_WHITE; flake.BackgroundTransparency = 1
            local d = math.random(2, 4)
            TweenService:Create(flake, TweenInfo.new(d), {Position = UDim2.new(flake.Position.X.Scale, math.random(-5, 5), 1.1, 0), TextTransparency = 1}):Play()
            task.delay(d, function() flake:Destroy() end)
        end
    end)
end
createSnow(frame)

local container = Instance.new("Frame", frame)
container.Size = UDim2.new(1, 0, 1, -35); container.Position = UDim2.fromOffset(0, 35); container.BackgroundTransparency = 1

local title = Instance.new("TextButton", frame)
title.Size = UDim2.new(1, 0, 0, 35); title.BackgroundTransparency = 1; title.Text = "SMVLLHUB INSTANT"; title.Font = Enum.Font.GothamBold; title.TextSize = isMobile and 12 or 14; title.TextColor3 = SMVLL_GREEN

local isMinimized = false
title.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.fromOffset(UI_WIDTH, 35) or UDim2.fromOffset(UI_WIDTH, UI_HEIGHT)
    TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = targetSize}):Play()
    container.Visible = not isMinimized
end)

local status = Instance.new("TextLabel", container)
status.Size = UDim2.new(1, -10, 0, 20); status.Position = UDim2.fromOffset(5, 0); status.BackgroundTransparency = 1; status.Text = "READY"; status.Font = Enum.Font.GothamMedium; status.TextSize = 10; status.TextColor3 = Color3.fromRGB(150, 150, 150)

local function createBtn(text, pos)
    local btn = Instance.new("TextButton", container)
    btn.Size = UDim2.new(1, -20, 0, 35); btn.Position = pos; btn.BackgroundColor3 = Color3.fromRGB(15, 15, 15); btn.Text = text; btn.Font = Enum.Font.GothamBold; btn.TextSize = 12; btn.TextColor3 = SMVLL_TEXT
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    local s = Instance.new("UIStroke", btn); s.Color = SMVLL_GREEN; s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    return btn, s
end

local setBtn, setStroke = createBtn("SET POSITION", UDim2.fromOffset(10, 30))
local desyncBtn, dsStroke = createBtn("ENABLE DESYNC", UDim2.fromOffset(10, 75))

local footer = Instance.new("TextLabel", container); footer.Size = UDim2.new(1,0,0,14); footer.Position = UDim2.fromOffset(0, UI_HEIGHT-65); footer.BackgroundTransparency = 1; footer.Text = "discord.gg/u53NcW3jFb"; footer.Font = Enum.Font.Code; footer.TextSize = 9; footer.TextColor3 = SMVLL_GREEN

-- --- LOGIQUE BOUTONS ---

setBtn.MouseButton1Click:Connect(function()
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        pos1 = hrp.CFrame
        createBeam(pos1.Position, 1)
        setBtn.TextColor3 = SMVLL_GREEN
        status.Text = "POS SET ‚úÖ"
    end
end)

desyncBtn.MouseButton1Click:Connect(function()
    desyncActive = not desyncActive
    if desyncActive then
        applyFFlags(FFlags)
        if firstActivation then
            RespawnPlayer()
            firstActivation = false
        end
        desyncBtn.Text = "DESYNC ACTIVE"
        desyncBtn.TextColor3 = SMVLL_GREEN
        status.Text = "DESYNC ON ‚úÖ"
    else
        applyFFlags(defaultFFlags)
        desyncBtn.Text = "ENABLE DESYNC"
        desyncBtn.TextColor3 = SMVLL_TEXT
        status.Text = "DESYNC OFF"
    end
end)

-- AUTO TARGET
task.spawn(function()
    while task.wait(1) do
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            local closest, dist = nil, math.huge
            for _, v in ipairs(targetPositions) do
                local d = (hrp.Position - v).Magnitude
                if d < dist then dist = d; closest = v end
            end
            if closest then pos2 = CFrame.new(closest); createBeam(pos2.Position, 2) end
        end
    end
end)

-- TP STEAL FIX (S√©quence de TP am√©lior√©e)
ProximityPromptService.PromptButtonHoldEnded:Connect(function(prompt, who)
    if who ~= LocalPlayer then return end
    local txt = (prompt.Name .. prompt.ActionText):lower()
    if txt:find("steal") or txt:find("grab") or txt:find("voler") or txt:find("ramasser") then
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        
        -- Am√©lioration du TP : Utilise task.defer pour √©viter les cancels d'action
        task.spawn(function()
            if pos1 then 
                hrp.CFrame = pos1 
            end
            
            task.wait(0.08) -- D√©lai l√©ger pour stabiliser la position initiale
            
            if pos2 then 
                hrp.CFrame = pos2 
            end
            status.Text = "STEAL EXECUTED ‚úÖ"
        end)
    end
end)